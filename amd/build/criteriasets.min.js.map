{"version":3,"sources":["../src/criteriasets.js"],"names":["define","$","ajax","notification","str","templates","ModalFactory","ModalEvents","refreshSets","modal","contextId","manage","canPublish","modalBody","getBody","modalFooter","getFooter","refreshButton","find","buttonWidth","width","spinner","hide","css","marginLeft","marginRight","show","request","call","methodname","args","contextid","includeshared","done","response","context","ownedSets","ownedsets","sharedSets","sharedsets","render","html","js","replaceNodeContents","fail","exception","init","get_strings","key","component","s","title","trigger","footer","create","body","large","on","getRoot","shown","setButton","appendNodeContents","parent","siblings"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Launches a modal dialogue that enables users to manage their criteria sets for the structured feedback plugin.\n *\n * See template: assignfeedback_structured/criteriasets\n *               assignfeedback_structured/criteriasets_footer\n *\n * @module     assignfeedback_structured/criteriasets\n * @class      criteriasets\n * @package    assignfeedback_structured\n * @copyright  2017 Lancaster University {@link http://www.lancaster.ac.uk/}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     Tony Butler <a.butler4@lancaster.ac.uk>\n */\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'core/str',\n        'core/templates',\n        'core/modal_factory',\n        'core/modal_events'\n    ],\n    function($, ajax, notification, str, templates, ModalFactory, ModalEvents) {\n        var criteriaSets = {\n            /**\n             * Init function.\n             *\n             * @param {number} contextId The context ID of the current assignment instance.\n             * @param {boolean} manage Whether a full management interface is required (otherwise it's read only).\n             * @param {boolean} canPublish Whether the current user can publish criteria sets.\n             * @param {object[]} ownedSets An array of data objects for all saved criteria sets owned by the current user.\n             * @param {object[]} sharedSets An array of data objects for any other available criteria sets.\n             */\n            init: function(contextId, manage, canPublish, ownedSets, sharedSets) {\n                str.get_strings([\n                    {key: 'criteriasetssaved', component: 'assignfeedback_structured'},\n                    {key: 'criteriasetsmanage', component: 'assignfeedback_structured'}\n                ]).done(function(s) {\n                    var context = {\n                        contextId: contextId,\n                        manage: manage,\n                        canPublish: canPublish,\n                        ownedSets: ownedSets,\n                        sharedSets: sharedSets\n                    };\n                    var footerContext = {\n                        manage: manage\n                    };\n                    var title = s[0],\n                        trigger = $('#id_assignfeedback_structured_critset');\n                    if (manage) {\n                        title = s[1];\n                        trigger = $('#id_assignfeedback_structured_critsetsmanage');\n                    }\n                    templates.render('assignfeedback_structured/criteriasets_footer', footerContext).done(function(footer) {\n                        ModalFactory.create({\n                            title: title,\n                            body: templates.render('assignfeedback_structured/criteriasets', context),\n                            footer: footer,\n                            large: false\n                        }, trigger).done(function(modal) {\n                            var refreshButton = modal.getFooter().find('[data-action=\"refresh\"]');\n                            refreshButton.on('click', function() {\n                                refreshSets(modal, contextId, manage, canPublish);\n                            });\n                            // Refresh automatically when showing the modal.\n                            modal.getRoot().on(ModalEvents.shown, function() {\n                                refreshSets(modal, contextId, manage, canPublish);\n                            });\n                        }).fail(notification.exception);\n                    }).fail(notification.exception);\n                });\n\n                // Add a hidden spinner after the 'Use a saved criteria set' button.\n                if (!manage) {\n                    var setButton = $('#id_assignfeedback_structured_critset');\n                    templates.render('core/loading', {}).done(function(html, js) {\n                        templates.appendNodeContents(setButton.parent(), html, js);\n                        setButton.siblings('.loading-icon').hide();\n                    }).fail(notification.exception);\n                }\n            }\n        };\n\n        /**\n         * Function to call a web service method via AJAX to update the list of criteria sets.\n         *\n         * @param {object} modal The modal dialogue to be refreshed.\n         * @param {number} contextId The context ID of the current assignment instance.\n         * @param {boolean} manage Whether the modal provides a management interface.\n         * @param {boolean} canPublish Whether the current user can publish criteria sets.\n         */\n        function refreshSets(modal, contextId, manage, canPublish) {\n            var modalBody = modal.getBody(),\n                modalFooter = modal.getFooter(),\n                refreshButton = modalFooter.find('[data-action=\"refresh\"]'),\n                buttonWidth = refreshButton.width(),\n                spinner = modalFooter.find('.loading-icon');\n\n            refreshButton.hide();\n            spinner.css({marginLeft: buttonWidth / 2 + 'px', marginRight: buttonWidth / 2 + 'px'});\n            spinner.show();\n\n            var request = ajax.call([{\n                methodname: 'assignfeedback_structured_get_criteriasets',\n                args: {\n                    contextid: contextId,\n                    includeshared: !manage\n                }\n            }]);\n\n            request[0].done(function(response) {\n                var context = {\n                    contextId: contextId,\n                    manage: manage,\n                    canPublish: canPublish,\n                    ownedSets: response.ownedsets,\n                    sharedSets: response.sharedsets\n                };\n                templates.render('assignfeedback_structured/criteriasets', context).done(function(html, js) {\n                    templates.replaceNodeContents(modalBody, html, js);\n                    spinner.hide();\n                    refreshButton.show();\n                }).fail(notification.exception);\n            }).fail(notification.exception);\n        }\n\n        return criteriaSets;\n    }\n);\n"],"file":"criteriasets.min.js"}