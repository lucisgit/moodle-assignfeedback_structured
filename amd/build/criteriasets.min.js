/**
 * Launches a modal dialogue that enables users to manage their criteria sets for the structured feedback plugin.
 *
 * See template: assignfeedback_structured/criteriasets
 *               assignfeedback_structured/criteriasets_footer
 *
 * @module     assignfeedback_structured/criteriasets
 * @class      criteriasets
 * @copyright  2017 Lancaster University {@link http://www.lancaster.ac.uk/}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author     Tony Butler <a.butler4@lancaster.ac.uk>
 */
define("assignfeedback_structured/criteriasets",["jquery","core/ajax","core/notification","core/str","core/templates","core/modal_factory","core/modal_events"],(function($,ajax,notification,str,templates,ModalFactory,ModalEvents){function refreshSets(modal,contextId,manage,canPublish){var modalBody=modal.getBody(),modalFooter=modal.getFooter(),refreshButton=modalFooter.find('[data-action="refresh"]'),buttonWidth=refreshButton.width(),spinner=modalFooter.find(".loading-icon");refreshButton.hide(),spinner.css({marginLeft:buttonWidth/2+"px",marginRight:buttonWidth/2+"px"}),spinner.show(),ajax.call([{methodname:"assignfeedback_structured_get_criteriasets",args:{contextid:contextId,includeshared:!manage}}])[0].done((function(response){var context={contextId:contextId,manage:manage,canPublish:canPublish,ownedSets:response.ownedsets,sharedSets:response.sharedsets};templates.render("assignfeedback_structured/criteriasets",context).done((function(html,js){templates.replaceNodeContents(modalBody,html,js),spinner.hide(),refreshButton.show()})).fail(notification.exception)})).fail(notification.exception)}return{init:function(contextId,manage,canPublish,ownedSets,sharedSets){if(str.get_strings([{key:"criteriasetssaved",component:"assignfeedback_structured"},{key:"criteriasetsmanage",component:"assignfeedback_structured"}]).done((function(s){var context={contextId:contextId,manage:manage,canPublish:canPublish,ownedSets:ownedSets,sharedSets:sharedSets},footerContext={manage:manage},title=s[0],trigger=$("#id_assignfeedback_structured_critset");manage&&(title=s[1],trigger=$("#id_assignfeedback_structured_critsetsmanage")),templates.render("assignfeedback_structured/criteriasets_footer",footerContext).done((function(footer){ModalFactory.create({title:title,body:templates.render("assignfeedback_structured/criteriasets",context),footer:footer,large:!1},trigger).done((function(modal){modal.getFooter().find('[data-action="refresh"]').on("click",(function(){refreshSets(modal,contextId,manage,canPublish)})),modal.getRoot().on(ModalEvents.shown,(function(){refreshSets(modal,contextId,manage,canPublish)}))})).fail(notification.exception)})).fail(notification.exception)})),!manage){var setButton=$("#id_assignfeedback_structured_critset");templates.render("core/loading",{}).done((function(html,js){templates.appendNodeContents(setButton.parent(),html,js),setButton.siblings(".loading-icon").hide()})).fail(notification.exception)}}}}));

//# sourceMappingURL=criteriasets.min.js.map