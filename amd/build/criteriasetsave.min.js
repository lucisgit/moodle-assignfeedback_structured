define("assignfeedback_structured/criteriasetsave",["exports","core/ajax","core/notification","core/str","core/templates","./criteriasets","./cssavemodal"],(function(_exports,_ajax,_notification,_str,_templates,_criteriasets,_cssavemodal){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Launches a modal dialogue that enables users to save the configured criteria set for the structured feedback plugin.
   *
   * See template: assignfeedback_structured/criteriasetsave
   *
   * @module     assignfeedback_structured/criteriasetsave
   * @class      criteriasetsave
   * @copyright  2017 Lancaster University {@link http://www.lancaster.ac.uk/}
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @author     Tony Butler <a.butler4@lancaster.ac.uk>
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveSet=_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_cssavemodal=_interopRequireDefault(_cssavemodal);_exports.init=async(contextId,canPublish)=>{const title=await(0,_str.getString)("criteriasetsave","assignfeedback_structured"),button=document.querySelector("#id_assignfeedback_structured_critsetsave");button.addEventListener("click",(async()=>{const templateContext={contextId:contextId,canPublish:canPublish},body=await _templates.default.render("assignfeedback_structured/criteriasetsave",templateContext),modal=await _cssavemodal.default.create({title:title,body:body});await(0,_criteriasets.modalActive)(button);const modalFooter=await modal.getFooter(),modalBody=await modal.getBody(),nameInput=modalBody.find('[name="criteriaset-name"]'),shareBox=modalBody.find('[name="criteriaset-publish"]'),saveButton=modalFooter.find(modal.getActionSelector("save"));modalFooter.find(modal.getActionSelector("save")).prop("disabled",!0),modalBody.find(".loading-icon").hide(),nameInput.on("keyup blur",(()=>{nameInput.val().trim()?saveButton.prop("disabled",!1):saveButton.prop("disabled",!0)})),nameInput.on("keydown",(e=>{13===e.keyCode&&(e.preventDefault(),shareBox.focus())})),shareBox.on("keydown",(e=>{13===e.keyCode&&(e.preventDefault(),saveButton.focus())})),saveButton.on("keydown",(e=>{13===e.keyCode&&e.preventDefault()}))}))};_exports.saveSet=async modal=>{const modalRoot=await modal.getRoot(),contextId=modalRoot.find(".criteriasetsave-page").data("context"),nameInput=modalRoot.find('[name="criteriaset-name"]'),rawName=nameInput.val().trim(),spinner=modalRoot.find(".loading-icon");let shared=!1;const name=rawName.charAt(0).toUpperCase()+rawName.slice(1);nameInput.val(name),modalRoot.find('[name="criteriaset-publish"]').prop("checked")&&(shared=!0),spinner.show();const criteria=[];for(const name of document.querySelectorAll('input[id^="id_assignfeedback_structured_critname"]'))if(name.value.trim().length){const descField=name.parentElement.parentElement.nextElementSibling.querySelector('[name^="assignfeedback_structured_critdesc"]');let descText="";descField.value?descText=descField.value.trim():descField.textContent&&(descText=descField.textContent.trim()),criteria.push({name:name.value.trim(),description:descText})}const request=_ajax.default.call([{methodname:"assignfeedback_structured_save_criteriaset",args:{contextid:contextId,name:name,criteria:criteria,shared:shared}}]),response=await request[0];!0===response.hide&&(modal.destroy(),document.querySelector("#id_assignfeedback_structured_critsetsmanage").disabled=!1),await _notification.default.alert(response.title,response.body,response.label),spinner.hide()}}));

//# sourceMappingURL=criteriasetsave.min.js.map