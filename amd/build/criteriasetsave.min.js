/**
 * Launches a modal dialogue that enables users to save the configured criteria set for the structured feedback plugin.
 *
 * See template: assignfeedback_structured/criteriasetsave
 *
 * @module     assignfeedback_structured/criteriasetsave
 * @class      criteriasetsave
 * @copyright  2017 Lancaster University {@link http://www.lancaster.ac.uk/}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author     Tony Butler <a.butler4@lancaster.ac.uk>
 */
define("assignfeedback_structured/criteriasetsave",["jquery","core/ajax","core/notification","core/str","core/templates","core/modal_factory","core/modal_events"],(function($,ajax,notification,str,templates,ModalFactory,ModalEvents){return{init:function(contextId,canPublish){str.get_string("criteriasetsave","assignfeedback_structured").done((function(title){var context={canPublish:canPublish},trigger=$("#id_assignfeedback_structured_critsetsave");ModalFactory.create({title:title,body:templates.render("assignfeedback_structured/criteriasetsave",context),type:ModalFactory.types.SAVE_CANCEL,large:!1},trigger).done((function(modal){modal.getFooter().find('[data-action="save"]').prop("disabled",!0),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),function(modal,contextId){var modalNode=modal.getRoot(),nameNode=modalNode.find('[name="criteriaset-name"]'),rawName=nameNode.val().trim(),shared=!1,spinner=modalNode.find(".loading-icon"),name=rawName.charAt(0).toUpperCase()+rawName.slice(1);nameNode.val(name),modalNode.find('[name="criteriaset-publish"]').prop("checked")&&(shared=!0);spinner.show();var criteria=[];modalNode.parent().parent().find('[id^="id_assignfeedback_structured_critname"]').each((function(){if($(this).val().trim().length){var descText,descNode=$(this).parent().parent().next().find('[name^="assignfeedback_structured_critdesc"]');descNode.length||(descNode=$(this).parent().parent().next().find('[data-fieldtype="textarea"]')),descText=descNode.val()?descNode.val().trim():descNode.text()?descNode.text().trim():"",criteria.push({name:$(this).val().trim(),description:descText})}})),ajax.call([{methodname:"assignfeedback_structured_save_criteriaset",args:{contextid:contextId,name:name,criteria:criteria,shared:shared}}])[0].done((function(response){!0===response.hide&&(modal.hide(),$("#id_assignfeedback_structured_critsetsmanage").prop("disabled",!1)),notification.alert(response.title,response.body,response.label)})).fail(notification.exception).always((function(){spinner.hide()}))}(modal,contextId)})),modal.getRoot().on(ModalEvents.hidden,(function(){$(this).find('[name="criteriaset-name"]').val(""),$(this).find('[name="criteriaset-publish"]').prop("checked",!1),$(this).find('[data-action="save"]').prop("disabled",!0)}))})).fail(notification.exception)})).fail(notification.exception)}}}));

//# sourceMappingURL=criteriasetsave.min.js.map